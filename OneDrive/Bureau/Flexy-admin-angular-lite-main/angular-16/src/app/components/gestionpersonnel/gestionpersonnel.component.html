<mat-card>
  <mat-card-content>
    <h2>Liste des Personnels</h2>

    <button mat-raised-button color="primary" (click)="resetSelectedPersonnel()">Ajouter un Personnel</button>

    <div *ngIf="selectedPersonnel">
      <h3>{{ selectedPersonnel.id ? 'Modifier' : 'Ajouter' }} un Personnel</h3>
      
      
      <form [formGroup]="personnelForm" (ngSubmit)="onSubmit()">
        <ng-container *ngIf="!selectedPersonnel.id">
          <mat-form-field appearance="fill">
            <mat-label>Nom</mat-label>
            <input matInput type="text" formControlName="nom" name="nom" placeholder="Nom" required>
            <mat-error *ngIf="personnelForm.get('nom')?.hasError('required') && personnelForm.get('nom')?.touched">Le nom est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('nom')?.hasError('pattern') && personnelForm.get('nom')?.touched">Le nom ne peut contenir que des lettres.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>Prénom</mat-label>
            <input matInput type="text" formControlName="prenom" name="prenom" placeholder="Prénom" required>
            <mat-error *ngIf="personnelForm.get('prenom')?.hasError('required') && personnelForm.get('prenom')?.touched">Le prénom est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('prenom')?.hasError('pattern') && personnelForm.get('prenom')?.touched">Le prénom ne peut contenir que des lettres.</mat-error>
          </mat-form-field>

        
          <mat-form-field appearance="fill">
            <mat-label>Adresse</mat-label>
            <input matInput type="text" formControlName="adresse" name="adresse" placeholder="Adresse" required>
            <mat-error *ngIf="personnelForm.get('adresse')?.hasError('required') && personnelForm.get('adresse')?.touched">L'adresse est requise.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email" name="email" placeholder="Email" required>
            <mat-error *ngIf="personnelForm.get('email')?.hasError('required') && personnelForm.get('email')?.touched">L'email est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('email')?.hasError('email') && personnelForm.get('email')?.touched">Veuillez entrer un email valide.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>Numéro de téléphone</mat-label>
            <input matInput type="text" formControlName="numTelephone" name="numTelephone" placeholder="Numéro de téléphone" required>
            <mat-error *ngIf="personnelForm.get('numTelephone')?.hasError('required') && personnelForm.get('numTelephone')?.touched">Le numéro de téléphone est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('numTelephone')?.hasError('pattern') && personnelForm.get('numTelephone')?.touched">Le numéro de téléphone doit contenir exactement 8 chiffres.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>ID CNSS</mat-label>
            <input matInput type="number" formControlName="idcnss" name="idcnss" placeholder="ID CNSS" required>
            <mat-error *ngIf="personnelForm.get('idcnss')?.hasError('required') && personnelForm.get('idcnss')?.touched">L'ID CNSS est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('idcnss')?.hasError('pattern') && personnelForm.get('idcnss')?.touched">L'ID CNSS doit contenir exactement 10 chiffres.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>CIN</mat-label>
            <input matInput type="number" formControlName="cin" name="cin" placeholder="CIN" required>
            <mat-error *ngIf="personnelForm.get('cin')?.hasError('required') && personnelForm.get('cin')?.touched">Le CIN est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('cin')?.hasError('pattern') && personnelForm.get('cin')?.touched">Le CIN doit contenir exactement 8 chiffres.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>Enfants à charge</mat-label>
            <input matInput type="number" formControlName="enfantsacharge" name="enfantsacharge" placeholder="Enfants à charge" required>
            <mat-error *ngIf="personnelForm.get('enfantsacharge')?.hasError('required') && personnelForm.get('enfantsacharge')?.touched">Le nombre d'enfants à charge est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('enfantsacharge')?.hasError('min') && personnelForm.get('enfantsacharge')?.touched">Le nombre d'enfants à charge ne peut pas être négatif.</mat-error>
          </mat-form-field>
        
          <!-- Champ Grade avec liste déroulante -->
          <mat-form-field appearance="fill">
            <mat-label>Grade</mat-label>
            <mat-select formControlName="grade" name="grade" placeholder="Sélectionnez le grade" required>
              <mat-option value="directeur">Directeur</mat-option>
              <mat-option value="sous-directeur">Sous-directeur</mat-option>
              <mat-option value="chef-service">Chef de service</mat-option>
              <mat-option value="sous-chef-service">Sous-chef de service</mat-option>
              <mat-option value="secretaire">Secrétaire</mat-option>
            </mat-select>
            <mat-error *ngIf="personnelForm.get('grade')?.hasError('required') && personnelForm.get('grade')?.touched">Le grade est requis.</mat-error>
          </mat-form-field>
        
          <!-- Champ Catégorie avec liste déroulante -->
          <mat-form-field appearance="fill">
            <mat-label>Catégorie</mat-label>
            <mat-select formControlName="categorie" name="categorie" placeholder="Sélectionnez la catégorie" required>
              <mat-option value="cadre-superieur">Cadre supérieur</mat-option>
              <mat-option value="cadre-intermediaire">Cadre intermédiaire</mat-option>
              <mat-option value="cadre-jeune">Cadre jeune</mat-option>
              <mat-option value="employe">Employé</mat-option>
              <mat-option value="ouvrier">Ouvrier</mat-option>
            </mat-select>
            <mat-error *ngIf="personnelForm.get('categorie')?.hasError('required') && personnelForm.get('categorie')?.touched">La catégorie est requise.</mat-error>
          </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Poste</mat-label>
          <input matInput type="text" formControlName="poste" name="poste" placeholder="Poste" required>
          <mat-error *ngIf="personnelForm.get('nom')?.hasError('required') && personnelForm.get('nom')?.touched">Le poste est requis.</mat-error>
          <mat-error *ngIf="personnelForm.get('nom')?.hasError('pattern') && personnelForm.get('nom')?.touched">Le poste ne peut contenir que des lettres.</mat-error>
        </mat-form-field>
        

        <mat-form-field appearance="fill">
          <mat-label>Rôle</mat-label>
          <mat-select formControlName="role" required>
            <mat-option *ngFor="let role of roles" [value]="role.id">{{ role.description }}</mat-option>
          </mat-select>
          <mat-error *ngIf="personnelForm.get('role')?.invalid && personnelForm.get('role')?.touched">
            Le rôle est requis.
          </mat-error>
        </mat-form-field>

        
       
        </ng-container>
        

        <!-- Afficher certains champs lors de la modification -->
        <ng-container *ngIf="selectedPersonnel.id">
          <mat-form-field appearance="fill">
            <mat-label>Adresse</mat-label>
            <input formControlName="adresse" matInput type="text" name="adresse" placeholder="Adresse" required>
            <mat-error *ngIf="personnelForm.get('adresse')?.hasError('required') && personnelForm.get('adresse')?.touched">L'adresse est requise.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>Email</mat-label>
            <input formControlName="email" matInput type="email" name="email" placeholder="Email" required>
            <mat-error *ngIf="personnelForm.get('email')?.hasError('required') && personnelForm.get('email')?.touched">L'email est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('email')?.hasError('email') && personnelForm.get('email')?.touched">Veuillez entrer un email valide.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>Numéro de téléphone</mat-label>
            <input formControlName="numTelephone" matInput type="text" name="numTelephone" placeholder="Numéro de téléphone" required>
            <mat-error *ngIf="personnelForm.get('numTelephone')?.hasError('required') && personnelForm.get('numTelephone')?.touched">Le numéro de téléphone est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('numTelephone')?.hasError('pattern') && personnelForm.get('numTelephone')?.touched">Le numéro de téléphone doit contenir exactement 8 chiffres.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>Catégorie</mat-label>
            <mat-select formControlName="categorie" name="categorie" placeholder="Sélectionnez la catégorie" required>
              <mat-option value="cadre-superieur">Cadre supérieur</mat-option>
              <mat-option value="cadre-intermediaire">Cadre intermédiaire</mat-option>
              <mat-option value="cadre-jeune">Cadre jeune</mat-option>
              <mat-option value="employe">Employé</mat-option>
              <mat-option value="ouvrier">Ouvrier</mat-option>
            </mat-select>
            <mat-error *ngIf="personnelForm.get('categorie')?.hasError('required') && personnelForm.get('categorie')?.touched">La catégorie est requise.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>Enfants à charge</mat-label>
            <input formControlName="enfantsacharge" matInput type="number" name="enfantsacharge" placeholder="Enfants à charge" required>
            <mat-error *ngIf="personnelForm.get('enfantsacharge')?.hasError('required') && personnelForm.get('enfantsacharge')?.touched">Le nombre d'enfants à charge est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('enfantsacharge')?.hasError('min') && personnelForm.get('enfantsacharge')?.touched">Le nombre d'enfants à charge ne peut pas être négatif.</mat-error>
          </mat-form-field>
        
          <mat-form-field appearance="fill">
            <mat-label>Grade</mat-label>
            <mat-select formControlName="grade" name="grade" placeholder="Sélectionnez le grade" required>
              <mat-option value="directeur">Directeur</mat-option>
              <mat-option value="sous-directeur">Sous-directeur</mat-option>
              <mat-option value="chef-service">Chef de service</mat-option>
              <mat-option value="sous-chef-service">Sous-chef de service</mat-option>
              <mat-option value="secretaire">Secrétaire</mat-option>
            </mat-select>
            <mat-error *ngIf="personnelForm.get('grade')?.hasError('required') && personnelForm.get('grade')?.touched">Le grade est requis.</mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Poste</mat-label>
            <input matInput type="text" formControlName="poste" name="poste" placeholder="Poste" required>
            <mat-error *ngIf="personnelForm.get('nom')?.hasError('required') && personnelForm.get('nom')?.touched">Le poste est requis.</mat-error>
            <mat-error *ngIf="personnelForm.get('nom')?.hasError('pattern') && personnelForm.get('nom')?.touched">Le poste ne peut contenir que des lettres.</mat-error>
          </mat-form-field>
          
          <!-- Rôle Field -->
<mat-form-field appearance="fill">
  <mat-label>Rôle</mat-label>
  <mat-select formControlName="role" required>
    <mat-option *ngFor="let role of roles" [value]="role.id">{{ role.description }}</mat-option>
  </mat-select>
  <mat-error *ngIf="personnelForm.get('role')?.invalid && personnelForm.get('role')?.touched">
    Le rôle est requis.
  </mat-error>
</mat-form-field>

          
        </ng-container>
        
        

        <button mat-raised-button color="primary" type="submit">{{ selectedPersonnel.id ? 'Modifier' : 'Ajouter' }}</button>
        <button mat-button type="button" (click)="resetSelectedPersonnel()">Annuler</button>
      </form>
    </div>

    <table mat-table [dataSource]="personnels" class="mat-elevation-z8">
      <ng-container matColumnDef="cin">
        <th mat-header-cell *matHeaderCellDef>CIN</th>
        <td mat-cell *matCellDef="let personnel">{{ personnel.cin }}</td>
      </ng-container>

      <ng-container matColumnDef="nom">
        <th mat-header-cell *matHeaderCellDef>Nom</th>
        <td mat-cell *matCellDef="let personnel">{{ personnel.nom }}</td>
      </ng-container>

      <ng-container matColumnDef="prenom">
        <th mat-header-cell *matHeaderCellDef>Prénom</th>
        <td mat-cell *matCellDef="let personnel">{{ personnel.prenom }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let personnel">
          <button mat-raised-button color="primary" (click)="editPersonnel(personnel)">Modifier</button>
          <button mat-raised-button color="warn" (click)="deletePersonnel(personnel.id)">Supprimer</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['cin', 'nom', 'prenom', 'actions']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['cin', 'nom', 'prenom', 'actions'];"></tr>
    </table>
